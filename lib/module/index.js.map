{"version":3,"names":["React","useCallback","useEffect","useState","StyleSheet","View","Animated","useSharedValue","useAnimatedStyle","withTiming","Easing","runOnJS","ShimmerEffect","BaseStyle","athensGray","iron","ProgressiveImage","source","style","inEasing","bezier","outEasing","animationDuration","onLoad","testID","props","loaded","setLoaded","placeholderShouldRender","setPlaceholderShouldRender","imageOpacity","placeholderOpacity","largeStyle","opacity","value","duration","easing","placeholderStyle","onLoadCallback","event","timeout","setTimeout","clearTimeout","container","image","thumbnailSource","absoluteFillObject","blurRadius","shimmerColors","shimmerDuration"],"sources":["index.tsx"],"sourcesContent":["// Packages\nimport React, { useCallback, useEffect, useState } from 'react';\nimport {\n    ImageLoadEventData,\n    NativeSyntheticEvent,\n    StyleSheet,\n    View,\n} from 'react-native';\nimport Animated, {\n    useSharedValue,\n    useAnimatedStyle,\n    withTiming,\n    Easing,\n    runOnJS,\n} from 'react-native-reanimated';\n\n// Components\nimport { ShimmerEffect } from './components/index';\n\n// Style\nimport BaseStyle from './style';\n\n// Constants\nimport { athensGray, iron } from './constants';\n\n// Props\nimport { ProgressiveImageProps } from './types';\n\nconst ProgressiveImage = ({\n    source,\n    style,\n    inEasing = Easing.bezier(0.65, 0, 0.35, 1),\n    outEasing = Easing.bezier(0.65, 0, 0.35, 1),\n    animationDuration = 350,\n    onLoad,\n    testID,\n    ...props\n}: ProgressiveImageProps) => {\n    const [loaded, setLoaded] = useState(false);\n    const [placeholderShouldRender, setPlaceholderShouldRender] =\n        useState(true);\n\n    const imageOpacity = useSharedValue(0);\n\n    // This is used for both the shimmerPlaceholder and the small image\n    const placeholderOpacity = useSharedValue(1);\n\n    const largeStyle = useAnimatedStyle(() => {\n        return {\n            opacity: withTiming(imageOpacity.value, {\n                duration: animationDuration,\n                easing: inEasing,\n            }),\n        };\n    });\n\n    const placeholderStyle = useAnimatedStyle(() => {\n        return {\n            opacity: withTiming(\n                placeholderOpacity.value,\n                {\n                    duration: animationDuration,\n                    easing: outEasing,\n                },\n                () => loaded && runOnJS(setPlaceholderShouldRender)(false),\n                // This component no longer needs to be rendered, so we can dispose of it here.\n            ),\n        };\n    });\n\n    const onLoadCallback = useCallback(\n        (event: NativeSyntheticEvent<ImageLoadEventData>) => {\n            setLoaded(true);\n            onLoad && onLoad(event);\n        },\n        [onLoad],\n    );\n\n    useEffect(() => {\n        if (loaded) {\n            imageOpacity.value = 1;\n\n            const timeout = setTimeout(\n                () => {\n                    placeholderOpacity.value = 0;\n                },\n                // Give this a slight delay so that we don't run\n                // into issues with flashes of empty content\n                animationDuration * 1.66,\n            );\n\n            // Cleanup function\n            return () => clearTimeout(timeout);\n        }\n\n        return;\n    }, [loaded]);\n\n    return (\n        <View style={[BaseStyle.container, style]} testID={testID}>\n            {placeholderShouldRender ? (\n                <Animated.View\n                    style={[BaseStyle.image, placeholderStyle]}\n                    testID=\"PlaceholderTestID\">\n                    {props.thumbnailSource ? (\n                        <Animated.Image\n                            style={{ ...StyleSheet.absoluteFillObject }}\n                            blurRadius={props.blurRadius ?? 3}\n                            source={props.thumbnailSource}\n                            testID=\"ProgressiveImageThumbnailTest\"\n                        />\n                    ) : (\n                        <ShimmerEffect\n                            colors={\n                                props.shimmerColors ?? [\n                                    athensGray,\n                                    iron,\n                                    athensGray,\n                                ]\n                            }\n                            duration={props.shimmerDuration ?? 1000}\n                        />\n                    )}\n                </Animated.View>\n            ) : null}\n\n            <Animated.Image\n                testID=\"ProgressiveImageHighResImage\"\n                style={[BaseStyle.image, largeStyle]}\n                onLoad={onLoadCallback}\n                source={source}\n            />\n        </View>\n    );\n};\n\nexport default ProgressiveImage;\n"],"mappings":"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"}